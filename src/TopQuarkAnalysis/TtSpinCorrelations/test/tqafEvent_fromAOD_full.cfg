process TQAF = {

  # initialize MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  replace MessageLogger.cerr.threshold = "INFO"
  # return trigger report (including filter efficiencies)
  untracked PSet options = { untracked bool wantSummary = true }

  # input
  source = PoolSource {
    include "TopQuarkAnalysis/TtSpinCorrelations/data/CSA07Muon.CMSSW_1_6_7-CSA07-Chowder-A1-PDMuon-ReReco-startup-Skims4-topSemiLepMuon.USER.cfi"
    untracked uint32 skipEvents = 0
  }
  untracked PSet maxEvents = {untracked int32 input = 1000}


  ### PAT/TQAF ###

  include "TopQuarkAnalysis/TtSpinCorrelations/data/patLayer0.cff"
  include "TopQuarkAnalysis/TopEventProducers/data/TtGenEvtProducer.cff"
  include "TopQuarkAnalysis/TtSpinCorrelations/data/patLayer1.cff"
  include "TopQuarkAnalysis/TopEventProducers/data/TtSemiEvtSolProducer.cfi"
  
  include "TopQuarkAnalysis/TtSpinCorrelations/test/tqafEvent_replaceDefaults.cff"

  # switch for decay mode filter (general usage switch in path "p")
//   include "TopQuarkAnalysis/TtSpinCorrelations/data/ttSemiElecFilter.cfi"
  include "TopQuarkAnalysis/TtSpinCorrelations/data/ttSemiMuonFilter.cfi"
//   include "TopQuarkAnalysis/TtSpinCorrelations/data/ttSemiLeptonicFilter.cfi"

  sequence tqafEvt_filterOn = {
    patLayer0,
    makeGenEvt,
    ttFilter,
    patLayer1,
    solutions
  }
  sequence tqafEvt_filterOff = {
    patLayer0,
    makeGenEvt,
    patLayer1,
    solutions
  }


  ### Schedule ###

  path p = {
    # switch on/off filter usage
//       tqafEvt_filterOn
      tqafEvt_filterOff
  }


  ### Output ###

  # to only accept events passing the complete path
  block EventSelection = {
    untracked PSet SelectEvents = {
      vstring SelectEvents = { "p" }
    }
  }

  module out = PoolOutputModule {
    using EventSelection
    untracked string fileName = "CSA07Muon-Chowder.test/tqafEvent_fromAOD_full.root"
    untracked vstring outputCommands = {
      "drop *",
      "keep edmTriggerResults_TriggerResults_*_*",
      "keep *_selectedLayer1Electrons_*_*",
      "keep *_selectedLayer1Muons_*_*",
      "keep *_selectedLayer1Taus_*_*",
      "keep *_selectedLayer1Jets_*_*",
      "keep *_selectedLayer1METs_*_*",
      "keep *_genParticles_*_*",
      "keep *_initSubset_*_*",
      "keep *_decaySubset_*_*",
      "keep *_genEvt_*_*",
      "keep *_solutions_*_*"
    }
    untracked bool verbose = true
  }

  endpath outpath = { out }

}
